# 更新日志

## 2025-11-03 更新 v1.2 - 分支统计功能

### 🌳 新增：分支选择和统计

根据用户反馈，添加了**分支统计功能**，现在可以：

1. **选择统计分支**
   - 默认统计所有分支（`--all`）
   - 可选择特定分支（master、main、develop、dev）
   - 支持输入自定义分支名

2. **查看分支信息**
   - 每个仓库显示当前统计的分支
   - 显示仓库的分支总数
   - 在仓库标题中突出显示

3. **灵活的分支选择**
   - 下拉选择器提供常用分支
   - 输入框支持自定义分支名
   - 按 Enter 键确认输入

### 🎨 UI 改进

1. **新增分支选择器**
   - 美观的下拉选择框
   - 自定义分支输入框
   - 提示文字说明

2. **仓库信息增强**
   - 📌 显示当前统计分支（带徽章）
   - 🌿 显示分支总数
   - 更清晰的信息层次

### 🔧 技术实现

#### 后端变更
- 新增 `getRepositoryBranches()` - 获取所有分支
- 更新 `getRepositoryAuthors()` - 支持指定分支
- 更新 `getAuthorStats()` - 支持指定分支
- 更新 `analyzeRepository()` - 返回分支信息
- API 接受 `branch` 参数

#### 前端变更  
- 新增分支选择状态 `selectedBranch`
- 新增分支选择器 UI
- 新增自定义分支输入
- 显示分支信息在仓库卡片中

### 📊 使用场景

1. **整体评估** - 选择"所有分支"
2. **生产统计** - 选择 "master" 或 "main"
3. **开发分支** - 选择 "develop" 或 "dev"
4. **功能分支** - 输入 "feature/xxx"
5. **版本统计** - 输入 "release/v2.0"

### 📝 文档更新

- 新增 `BRANCH_FEATURE.md` - 详细的分支功能说明
- 更新 `README.md` - 添加分支功能说明
- 更新使用指南

### 💡 关键改进

**问题**：原来只能统计所有分支，无法区分不同分支的贡献

**解决**：
- 添加分支选择功能
- 支持统计特定分支
- 显示分支信息

**好处**：
- 更精确的统计
- 支持多种统计场景
- 便于版本管理和代码审查

---

## 2025-11-03 更新 v1.1 - 文件夹选择功能

### 🎉 新增功能：文件夹选择器

为了提升用户体验，新增了三种选择文件夹的方式：

#### 1. 📁 文件选择按钮
- 在输入框右侧添加了"📁 选择"按钮
- 点击后打开系统文件选择器
- 支持现代浏览器的 File System Access API
- 降级支持传统的 `input[type="file"]`

#### 2. 🖱️ 拖放文件夹
- 新增拖放区域，支持直接拖放文件夹
- 拖动时有视觉反馈（边框变色、图标动画）
- 松手即可选择文件夹

#### 3. ⌨️ 手动输入（原有方式）
- 保留原有的手动输入功能
- 适合复制粘贴路径的场景

### 💡 重要说明

由于浏览器安全限制，JavaScript 无法直接获取文件系统的完整路径。因此：
- 使用文件选择器或拖放方式后，会提示文件夹名称
- 用户需要在输入框中手动输入该文件夹的完整路径
- 推荐直接使用手动输入方式（最直接）

### 🎨 UI 改进

1. **新增拖放区域**
   - 虚线边框设计
   - 拖动时变蓝色并放大
   - 图标跳动动画

2. **文件选择按钮**
   - 紫色主题配色
   - 悬停时变色效果
   - 响应式布局支持

3. **更新占位符提示**
   - 添加使用步骤说明
   - Emoji 图标增强可读性
   - 清晰的操作指引

### 📝 代码变更

#### 前端文件
- `frontend/src/App.jsx`
  - 新增 `handleFolderSelect()` - 处理文件选择
  - 新增 `openFolderPicker()` - 打开文件选择器
  - 新增 `handleDragOver()` - 处理拖动
  - 新增 `handleDragLeave()` - 处理拖动离开
  - 新增 `handleDrop()` - 处理拖放
  - 新增 `isDragging` 状态
  - 新增 `fileInputRef` 引用

- `frontend/src/App.css`
  - 新增 `.input-with-button` - 输入框和按钮容器
  - 新增 `.folder-select-btn` - 选择按钮样式
  - 新增 `.drop-zone` - 拖放区域样式
  - 新增 `.drop-zone-content` - 拖放内容样式
  - 新增 `.drop-zone-icon` - 图标样式
  - 新增 `.drop-zone-text` - 文字样式
  - 新增 `.drop-zone-hint` - 提示文字样式
  - 新增 `@keyframes bounce` - 跳动动画
  - 更新 `.placeholder` - 占位符样式
  - 新增 `.placeholder-hint` - 占位符提示样式
  - 更新移动端响应式样式

#### 文档更新
- `README.md` - 更新功能特性和使用说明
- `QUICKSTART.md` - 更新使用示例
- `SETUP_COMPLETE.md` - 更新界面特色说明

### 🔧 技术细节

#### File System Access API
```javascript
if ('showDirectoryPicker' in window) {
  window.showDirectoryPicker().then(dirHandle => {
    // 现代浏览器支持
  })
}
```

#### 传统文件输入（降级支持）
```html
<input 
  type="file" 
  webkitdirectory 
  directory 
  multiple 
  onChange={handleFolderSelect}
/>
```

#### 拖放 API
```javascript
const entry = item.webkitGetAsEntry()
if (entry && entry.isDirectory) {
  // 处理文件夹
}
```

### ⚠️ 浏览器兼容性

- **Chrome/Edge 86+**: 完全支持（File System Access API）
- **Firefox**: 部分支持（使用传统文件输入）
- **Safari**: 部分支持（使用传统文件输入）
- **移动浏览器**: 功能受限

### 📊 用户体验提升

| 方式 | 优点 | 缺点 |
|-----|------|------|
| 文件选择器 | 图形化界面，易于理解 | 需要手动输入完整路径 |
| 拖放文件夹 | 操作便捷，视觉直观 | 需要手动输入完整路径 |
| 手动输入 | 最直接，支持复制粘贴 | 需要知道完整路径 |

### 🎯 推荐使用方式

1. **最便捷**：直接输入或粘贴完整路径
2. **新手友好**：点击选择按钮，通过文件管理器定位
3. **高效操作**：从文件管理器拖放文件夹

### 📸 界面预览

新增的 UI 元素：
```
┌─────────────────────────────────────────┐
│ 文件夹路径：                            │
│ ┌────────────────────┬────────────────┐ │
│ │ /Users/...         │ 📁 选择        │ │
│ └────────────────────┴────────────────┘ │
│                                         │
│ ┌───────────────────────────────────┐   │
│ │           📂                      │   │
│ │ 也可以将文件夹拖放到此处            │   │
│ │ 💡 提示：浏览器安全限制...         │   │
│ └───────────────────────────────────┘   │
│                                         │
│ ┌───────────────────────────────────┐   │
│ │        开始分析                   │   │
│ └───────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

---

**更新者**：AI Assistant  
**更新日期**：2025-11-03  
**版本**：v1.1.0

